{
  "name": "Things Stack Community Downlink Converter for MClimate Vicki",
  "type": "DOWNLINK",
  "integrationType": "TTN",
  "debugMode": false,
  "debugSettings": {
    "failuresEnabled": true,
    "allEnabled": false,
    "allEnabledUntil": 1752669127301
  },
  "configuration": {
    "scriptLang": "TBEL",
    "decoder": null,
    "tbelDecoder": "// Decode an uplink message from a buffer\n// payload - array of bytes\n// metadata - key/value object\n\n/** Decoder **/\n\n// decode payload to string\nvar payloadStr = decodeToString(payload);\n\n// decode payload to JSON\n// var data = decodeToJson(payload);\n\nvar deviceName = 'Device A';\nvar deviceType = 'thermostat';\nvar customerName = 'Customer C';\nvar groupName = 'thermostat devices';\nvar manufacturer = 'Example corporation';\n// use assetName and assetType instead of deviceName and deviceType\n// to automatically create assets instead of devices.\n// var assetName = 'Asset A';\n// var assetType = 'building';\n\n// Result object with device/asset attributes/telemetry data\nvar result = {\n// Use deviceName and deviceType or assetName and assetType, but not both.\n   deviceName: deviceName,\n   deviceType: deviceType,\n// assetName: assetName,\n// assetType: assetType,\n// customerName: customerName,\n   groupName: groupName,\n   attributes: {\n       model: 'Model A',\n       serialNumber: 'SN111',\n       integrationName: metadata['integrationName'],\n       manufacturer: manufacturer\n   },\n   telemetry: {\n       temperature: 42,\n       humidity: 80,\n       rawData: payloadStr\n   }\n};\n\n/** Helper functions 'decodeToString' and 'decodeToJson' are already built-in **/\n\nreturn result;",
    "encoder": null,
    "tbelEncoder": "// Encode downlink data from incoming Rule Engine message\n\n// msg - JSON message payload downlink message json\n// msgType - type of message, for ex. 'ATTRIBUTES_UPDATED', 'POST_TELEMETRY_REQUEST', etc.\n// metadata - list of key-value pairs with additional data about the message\n// integrationMetadata - list of key-value pairs with additional data defined in Integration executing this converter\n\n/** Encoder **/\n\nvar data = [];\n\n// Process data from incoming message and metadata\n\nvar method = msg.method;\nvar params = JSON.parse(msg.params);\n\nswitch (method) {\n    case \"setKeepAlive\":\n        data.push(0x02);\n        data.push(params.setKeepAlive);\n        break;\n    case \"getKeepAliveTime\":\n        data.push(0x12);\n        break;\n    case \"recalibrateMotor\":\n        data.push(0x03);\n        break;\n    case \"getDeviceVersions\":\n        data.push(0x04);\n        break;\n    case \"setOpenWindow\": \n        var enabled = params.enabled == true ? 1 : 0;\n        var closeTime = parseInt(params.closeTime / 5);\n        var delta = parseInt(params.delta, 8);\n        var motorPosition = params.motorPosition;\n        var motorPositionFirstPart = motorPosition & 0xff;\n        var motorPositionSecondPart = (motorPosition >> 8) & 0xff;\n        data.push(0x06);\n        data.push(enabled);\n        data.push(closeTime);\n        data.push(motorPositionFirstPart);\n        data.push((motorPositionSecondPart << 4) | delta);\n        break;\n    case \"getOpenWindowParams\": \n        data.push(0x13);\n        break;\n    case \"setChildLock\":\n        data.push(0x07);\n        data.push(params.setChildLock == true ? 1 : 0);\n        break;\n     case \"getChildLock\": \n        data.push(0x14);\n        break;\n    case \"setTemperatureRange\":\n        data.push(0x08);\n        data.push(params.min);\n        data.push(params.max);\n        break;\n    case \"getTemperatureRange\":\n        data.push(0x15);\n        break;\n    case \"forceClose\": \n        data.push(0x0b);\n        break;\n    case \"setInternalAlgoParams\": \n        data.push(0x0c);\n        data.push(params.pFirstLast);\n        data.push(params.pNext);\n        break;\n    case \"getInternalAlgoParams\":\n        data.push(0x16);\n        break;\n    case \"setInternalAlgoTdiffParams\": \n        data.push(0x1a);\n        data.push(params.cold);\n        data.push(params.warm);\n        break;\n    case \"getInternalAlgoTdiffParams\":\n        data.push(0x17);\n        break;\n    case \"setOperationalMode\":\n        data.push(0x0d);\n        data.push(params.setOperationalMode);\n        break;\n    case \"getOperationalMode\":\n        data.push(0x18);\n        break;\n    case \"setTargetTemperature\":\n        data.push(0x0e);\n        data.push(params.setTargetTemperature);\n        break;\n    case \"setExternalTemperature\":\n        data.push(0x0f);\n        data.push(params.setExternalTemperature);\n        break;\n    case \"setJoinRetryPeriod\":\n        // period should be passed in minutes\n        var periodToPass = (params.setJoinRetryPeriod * 60) / 5;\n        periodToPass = toInt(periodToPass);\n        data.push(0x10);\n        data.push(periodToPass);\n        break;\n    case \"getJoinRetryPeriod\":\n        data.push(0x19);\n        break;\n    case \"setUplinkType\":\n        data.push(0x11);\n        data.push(params.setUplinkType);\n        break;\n    case \"getUplinkType\":\n        data.push(0x1b);\n        break;\n    case \"setTargetTemperatureAndMotorPosition\":\n        data.push(0x31);\n        data.push(params.motorPosition);\n        data.push(params.targetTemperature);\n        break;\n    case \"setWatchDogParams\":\n        data.push(0x1c);\n        data.push(params.confirmedUplinks);\n        data.push(params.unconfirmedUplinks);\n        break;\n    case \"getWatchDogParams\":\n        data.push(0x1d);\n        break;\n    case \"setPrimaryOperationalMode\":\n        data.push(0x1e);\n        data.push(params.setPrimaryOperationalMode);\n        break;\n    case \"getPrimaryOperationalMode\":\n        data.push(0x1f);\n        break;\n    case \"setProportionalAlgorithmParameters\":\n        data.push(0x2a);\n        data.push(params.coefficient);\n        data.push(params.period);\n        break;\n    case \"getProportionalAlgorithmParameters\":\n        data.push(0x29);\n        break;\n    case \"setTemperatureControlAlgorithm\":\n        data.push(0x2c);\n        data.push(params.setTemperatureControlAlgorithm);\n        break;\n    case \"getTemperatureControlAlgorithm\":\n        data.push(0x2b);\n        break;\n    case \"setMotorPositionOnly\":\n        var motorPosition = params.setMotorPositionOnly;\n        var motorPositionFirstPart = motorPosition & 0xff;\n        var motorPositionSecondPart = (motorPosition >> 8) & 0xff;\n        data.push(0x2d);\n        data.push(motorPositionSecondPart);\n        data.push(motorPositionFirstPart);\n        break;\n    case \"deviceReset\":\n        data.push(0x30);\n        break;\n    case \"setChildLockBehavior\":\n        data.push(0x35);\n        data.push(params.setChildLockBehavior);\n        break;\n    case \"getChildLockBehavior\":\n        data.push(0x34);\n        break;\n    case \"setProportionalGain\":\n        var kp = Math.round(params.setProportionalGain * 131072);\n        var kpFirstPart = kp & 0xff;\n        var kpSecondPart = (kp >> 8) & 0xff;\n        var kpThirdPart = (kp >> 16) & 0xff;\n        data.push(0x37);\n        data.push(kpThirdPart);\n        data.push(kpSecondPart);\n        data.push(kpFirstPart);\n        break;\n    case \"getProportionalGain\":\n        data.push(0x36);\n        break;\n    case \"setExternalTemperatureFloat\":\n        var temp = params.setExternalTemperatureFloat * 10;\n        var tempFirstPart = temp & 0xff;\n        var tempSecondPart = (temp >> 8) & 0xff;\n        data.push(0x3c);\n        data.push(tempSecondPart);\n        data.push(tempFirstPart);\n        break;\n    case \"setIntegralGain\":\n        var ki = Math.round(params.setIntegralGain * 131072);\n\n        var kiFirstPart = ki & 0xff;\n        var kiSecondPart = (ki >> 8) & 0xff;\n        var kiThirdPart = (ki >> 16) & 0xff;\n        data.push(0x3e);\n        data.push(kiThirdPart);\n        data.push(kiSecondPart);\n        data.push(kiFirstPart);\n        break;\n    case \"getIntegralGain\":\n        data.push(0x3d);\n        break;\n    case \"setPiRunPeriod\":\n        data.push(0x41);\n        data.push(params.setPiRunPeriod);\n        break;\n    case \"getPiRunPeriod\":\n        data.push(0x40);\n        break;\n    case \"setTempHysteresis\":\n        var tempHysteresis = params.setTempHysteresis * 10;\n        data.push(0x43);\n        data.push(tempHysteresis);\n        break;\n    case \"getTempHysteresis\":\n        data.push(0x42);\n        break;\n    case \"setOpenWindowPrecisely\":\n        var enabledValue = params.enabled ? 1 : 0;\n        var duration = parseInt(params.duration) / 5;\n        var delta = params.delta * 10;\n\n        data.push(0x45);\n        data.push(enabledValue);\n        data.push(duration);\n        data.push(delta);\n        break;\n    case \"getOpenWindowPrecisely\":\n        data.push(0x46);\n        break;\n    case \"setForceAttach\":\n        data.push(0x47);\n        data.push(params.setForceAttach);\n        break;\n    case \"getForceAttach\":\n        data.push(0x48);\n        break;\n    case \"sendCustomHexCommand\":\n        var sendCustomHexCommand = params.sendCustomHexCommand;\n        for (i = 0; i < sendCustomHexCommand.length; i += 2) {\n            var byteValue = parseInt(sendCustomHexCommand.substr(i, 2), 16);\n            data.push(byteValue);\n        }\n        break;\n    default:\n        break;\n}\n\n// Result object with encoded downlink payload\nvar result = {\n    contentType: \"JSON\",\n    // downlink data\n    data: JSON.stringify({\"downlinks\":[{\"f_port\":2,\"frm_payload\":bytesToBase64(data),\"priority\":\"NORMAL\"}]}),\n    metadata: {\n        \"devId\":\"vicki\"}\n};\n\nreturn result;",
    "updateOnlyKeys": [
      "manufacturer"
    ]
  },
  "additionalInfo": {
    "description": ""
  },
  "edgeTemplate": false,
  "converterVersion": 1
}